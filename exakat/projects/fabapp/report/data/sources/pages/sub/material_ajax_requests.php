<span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><a name="l1" /><br /><a name="l2" /></span><span style="color: #FF8000">/***********************************************************************************************************<br /><a name="l3" />*&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l4" />*&nbsp;&nbsp;&nbsp;&nbsp;@author&nbsp;Jon&nbsp;Le<br /><a name="l5" />*&nbsp;&nbsp;&nbsp;&nbsp;created&nbsp;on&nbsp;08.14.19&nbsp;<br /><a name="l6" />*&nbsp;&nbsp;&nbsp;&nbsp;CC&nbsp;BY-NC-AS&nbsp;UTA&nbsp;FabLab&nbsp;2016-2019<br /><a name="l7" />*&nbsp;&nbsp;&nbsp;&nbsp;FabApp&nbsp;V&nbsp;0.94<br /><a name="l8" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-House&nbsp;Keeping&nbsp;(DB&nbsp;cleanup,&nbsp;$status&nbsp;variable,&nbsp;class&nbsp;syntax)<br /><a name="l9" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-Multiple&nbsp;Materials<br /><a name="l10" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-Off-line&nbsp;Mode<br /><a name="l11" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-Sheet&nbsp;Goods<br /><a name="l12" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-Storage&nbsp;Box<br /><a name="l13" />*<br /><a name="l14" />*&nbsp;&nbsp;&nbsp;&nbsp;DESCRIPTION:&nbsp;AJAX&nbsp;POST&nbsp;call&nbsp;page&nbsp;to&nbsp;execute&nbsp;asyncronous&nbsp;JSON&nbsp;responses.&nbsp;&nbsp;Used<br /><a name="l15" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;edit.php,&nbsp;pickup,&nbsp;and&nbsp;end.php&nbsp;to&nbsp;add&nbsp;another&nbsp;material&nbsp;to&nbsp;a&nbsp;transaction.&nbsp;&nbsp;Page&nbsp;no&nbsp;<br /><a name="l16" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;longer&nbsp;allows&nbsp;the&nbsp;changing&nbsp;of&nbsp;a&nbsp;device&nbsp;for&nbsp;a&nbsp;ticket.&nbsp;&nbsp;After&nbsp;material&nbsp;addition&nbsp;to&nbsp;DB,&nbsp;edit's<br /><a name="l17" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HTML&nbsp;will&nbsp;be&nbsp;dressed&nbsp;differently&nbsp;than&nbsp;pickup's&nbsp;and&nbsp;end's.&nbsp;&nbsp;This&nbsp;is&nbsp;determines&nbsp;by&nbsp;$_POST<br /><a name="l18" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parameter&nbsp;"request_from_edit_page".&nbsp;&nbsp;The&nbsp;edit&nbsp;HTML&nbsp;will&nbsp;contain&nbsp;functions&nbsp;and&nbsp;tabel&nbsp;<br /><a name="l19" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;labels&nbsp;matching&nbsp;format&nbsp;of&nbsp;other&nbsp;materials&nbsp;from&nbsp;edit&nbsp;while&nbsp;<br /><a name="l20" />*&nbsp;&nbsp;&nbsp;&nbsp;FUTURE:&nbsp;&nbsp;&nbsp;&nbsp;Optionally&nbsp;sepparate&nbsp;edit.php&nbsp;&amp;&nbsp;pickup/end.php&nbsp;opperations.&nbsp;&nbsp;I&nbsp;did&nbsp;not<br /><a name="l21" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sepparate&nbsp;them&nbsp;currently&nbsp;because&nbsp;it&nbsp;would&nbsp;involve&nbsp;much&nbsp;of&nbsp;the&nbsp;same&nbsp;code<br /><a name="l22" />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;duplication,&nbsp;especially&nbsp;for&nbsp;Mats_Used::insert_material_used(....)&nbsp;processes<br /><a name="l23" />*&nbsp;&nbsp;&nbsp;&nbsp;BUGS:&nbsp;<br /><a name="l24" />*<br /><a name="l25" />***********************************************************************************************************/<br /><a name="l26" /><br /><a name="l27" /><br /><a name="l28" /></span><span style="color: #007700">include_once&nbsp;(</span><span style="color: #0000BB">filter_input</span><span style="color: #007700">(</span><span style="color: #0000BB">INPUT_SERVER</span><span style="color: #007700">,</span><span style="color: #DD0000">'DOCUMENT_ROOT'</span><span style="color: #007700">).</span><span style="color: #DD0000">'/connections/db_connect8.php'</span><span style="color: #007700">);<br /><a name="l29" />include_once&nbsp;(</span><span style="color: #0000BB">filter_input</span><span style="color: #007700">(</span><span style="color: #0000BB">INPUT_SERVER</span><span style="color: #007700">,</span><span style="color: #DD0000">'DOCUMENT_ROOT'</span><span style="color: #007700">).</span><span style="color: #DD0000">'/class/all_classes.php'</span><span style="color: #007700">);<br /><a name="l30" /><br /><a name="l31" /></span><span style="color: #FF8000">//&nbsp;authenticate&nbsp;permission&nbsp;for&nbsp;user<br /><a name="l32" /></span><span style="color: #0000BB">session_start</span><span style="color: #007700">();<br /><a name="l33" /></span><span style="color: #0000BB">$staff&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">unserialize</span><span style="color: #007700">(</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'staff'</span><span style="color: #007700">]);<br /><a name="l34" />if(!</span><span style="color: #0000BB">$staff&nbsp;</span><span style="color: #007700">||&nbsp;</span><span style="color: #0000BB">$staff</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">roleID&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">$role</span><span style="color: #007700">[</span><span style="color: #DD0000">"staff"</span><span style="color: #007700">])&nbsp;exit();<br /><a name="l35" /><br /><a name="l36" /></span><span style="color: #FF8000">//TESTING<br /><a name="l37" />//&nbsp;$_SERVER["REQUEST_METHOD"]&nbsp;=&nbsp;"POST";<br /><a name="l38" />//&nbsp;$_POST["add_edit_mat_used_instance"]&nbsp;=&nbsp;true;<br /><a name="l39" />//&nbsp;$_POST["m_id"]&nbsp;=&nbsp;"13";<br /><a name="l40" />//&nbsp;$_POST["trans_id"]&nbsp;=&nbsp;"42649";<br /><a name="l41" /><br /><a name="l42" /><br /><a name="l43" /></span><span style="color: #007700">if(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">"REQUEST_METHOD"</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #DD0000">"POST"&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;isset(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"add_new_material"</span><span style="color: #007700">]))&nbsp;{<br /><a name="l44" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$m_id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"m_id"</span><span style="color: #007700">];<br /><a name="l45" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$trans_id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"trans_id"</span><span style="color: #007700">];<br /><a name="l46" /><br /><a name="l47" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">check_posted_values</span><span style="color: #007700">(</span><span style="color: #0000BB">$m_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">);&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;regex&nbsp;passed&nbsp;valued;&nbsp;exit&nbsp;if&nbsp;invalid<br /><a name="l48" /><br /><a name="l49" />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;add&nbsp;to&nbsp;DB<br /><a name="l50" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$mu_id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mats_Used</span><span style="color: #007700">::</span><span style="color: #0000BB">insert_material_used</span><span style="color: #007700">(</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$m_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">[</span><span style="color: #DD0000">"used"</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$staff</span><span style="color: #007700">);<br /><a name="l51" />&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">is_int</span><span style="color: #007700">(</span><span style="color: #0000BB">$mu_id</span><span style="color: #007700">))&nbsp;{<br /><a name="l52" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(array(</span><span style="color: #DD0000">"error"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"Error&nbsp;associating&nbsp;material&nbsp;with&nbsp;ticket—</span><span style="color: #0000BB">$mu_id</span><span style="color: #DD0000">"</span><span style="color: #007700">));<br /><a name="l53" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit();<br /><a name="l54" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l55" /><br /><a name="l56" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;no&nbsp;errors:&nbsp;create&nbsp;object<br /><a name="l57" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$mat_used&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Mats_Used</span><span style="color: #007700">(</span><span style="color: #0000BB">$mu_id</span><span style="color: #007700">);<br /><a name="l58" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ticket&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Transactions</span><span style="color: #007700">(</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">);<br /><a name="l59" /><br /><a name="l60" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;HTML<br /><a name="l61" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$grouped_and_ungrouped&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mats_Used</span><span style="color: #007700">::</span><span style="color: #0000BB">group_materials_by_parent</span><span style="color: #007700">(</span><span style="color: #0000BB">$ticket</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">mats_used</span><span style="color: #007700">);<br /><a name="l62" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$grouplength_and_HTML&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">HTML_for_newly_added_mat_used</span><span style="color: #007700">(</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$grouped_and_ungrouped</span><span style="color: #007700">);<br /><a name="l63" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$parent_code&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">material</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">m_parent&nbsp;</span><span style="color: #007700">?&nbsp;</span><span style="color: #0000BB">str_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">"&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"_"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">material</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">m_parent</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">m_name</span><span style="color: #007700">)&nbsp;:&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;<br /><a name="l64" /><br /><a name="l65" />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(array(&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"mu_id"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$mu_id</span><span style="color: #007700">,<br /><a name="l66" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"grouplength"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$grouplength_and_HTML</span><span style="color: #007700">[</span><span style="color: #DD0000">"grouplength"</span><span style="color: #007700">],<br /><a name="l67" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"material_HTML"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$grouplength_and_HTML</span><span style="color: #007700">[</span><span style="color: #DD0000">"HTML"</span><span style="color: #007700">],&nbsp;<br /><a name="l68" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"material_name"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">material</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">m_name</span><span style="color: #007700">,<br /><a name="l69" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"parent_id"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$parent_code</span><span style="color: #007700">));<br /><a name="l70" />}<br /><a name="l71" /></span><span style="color: #FF8000">//&nbsp;inventory_processing.php&nbsp;call&nbsp;to&nbsp;update&nbsp;mats_used<br /><a name="l72" /></span><span style="color: #007700">elseif(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">"REQUEST_METHOD"</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #DD0000">"POST"&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;isset(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"update_inventory"</span><span style="color: #007700">]))&nbsp;{<br /><a name="l73" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$mats_used_changes&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">json_decode</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"mats_used_update"</span><span style="color: #007700">]);<br /><a name="l74" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$successes&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$errors&nbsp;</span><span style="color: #007700">=&nbsp;array();<br /><a name="l75" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;$response&nbsp;=&nbsp;array("type"&nbsp;=&gt;&nbsp;gettype($mats_used_changes[0]));<br /><a name="l76" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">foreach(</span><span style="color: #0000BB">$mats_used_changes&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$update</span><span style="color: #007700">)&nbsp;{<br /><a name="l77" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$update</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">notes</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">$update</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">notes&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$update</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">notes</span><span style="color: #007700">);<br /><a name="l78" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$outcome&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mats_Used</span><span style="color: #007700">::</span><span style="color: #0000BB">insert_material_used</span><span style="color: #007700">(</span><span style="color: #0000BB">null</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$update</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">m_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$update</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">status_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$staff</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$update</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">quantity_used</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$update</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">notes</span><span style="color: #007700">);<br /><a name="l79" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">is_int</span><span style="color: #007700">(</span><span style="color: #0000BB">$outcome</span><span style="color: #007700">))&nbsp;</span><span style="color: #0000BB">$errors</span><span style="color: #007700">[</span><span style="color: #0000BB">$update</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">m_id</span><span style="color: #007700">]&nbsp;=&nbsp;array(&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"m_id"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$update</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">m_id</span><span style="color: #007700">,<br /><a name="l80" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"message"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$outcome</span><span style="color: #007700">,<br /><a name="l81" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"notes"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$update</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">notes</span><span style="color: #007700">,<br /><a name="l82" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"status"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$update</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">status_id</span><span style="color: #007700">,&nbsp;<br /><a name="l83" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"quantity"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$update</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">quantity_used</span><span style="color: #007700">);<br /><a name="l84" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;</span><span style="color: #0000BB">$successes</span><span style="color: #007700">[</span><span style="color: #0000BB">$update</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">m_id</span><span style="color: #007700">]&nbsp;=&nbsp;array(&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"m_id"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$update</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">m_id</span><span style="color: #007700">,<br /><a name="l85" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"message"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$outcome</span><span style="color: #007700">,<br /><a name="l86" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"notes"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$update</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">notes</span><span style="color: #007700">,<br /><a name="l87" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"status"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$update</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">status_id</span><span style="color: #007700">,&nbsp;<br /><a name="l88" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"quantity"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$update</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">quantity_used</span><span style="color: #007700">);<br /><a name="l89" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l90" /><br /><a name="l91" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$response&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">"successes"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$successes</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"errors"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$errors</span><span style="color: #007700">);<br /><a name="l92" />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$response</span><span style="color: #007700">);<br /><a name="l93" />}<br /><a name="l94" /></span><span style="color: #FF8000">//&nbsp;used&nbsp;by&nbsp;edit.php<br /><a name="l95" /></span><span style="color: #007700">elseif(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">"REQUEST_METHOD"</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #DD0000">"POST"&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;isset(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"add_edit_mat_used_instance"</span><span style="color: #007700">]))&nbsp;{<br /><a name="l96" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$m_id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"m_id"</span><span style="color: #007700">];<br /><a name="l97" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$trans_id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"trans_id"</span><span style="color: #007700">];<br /><a name="l98" /><br /><a name="l99" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">check_posted_values</span><span style="color: #007700">(</span><span style="color: #0000BB">$m_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">);&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;regex&nbsp;passed&nbsp;valued;&nbsp;exit&nbsp;if&nbsp;invalid<br /><a name="l100" /><br /><a name="l101" />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;add&nbsp;to&nbsp;DB<br /><a name="l102" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$mu_id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mats_Used</span><span style="color: #007700">::</span><span style="color: #0000BB">insert_material_used</span><span style="color: #007700">(</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$m_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">[</span><span style="color: #DD0000">"used"</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$staff</span><span style="color: #007700">);<br /><a name="l103" />&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">is_int</span><span style="color: #007700">(</span><span style="color: #0000BB">$mu_id</span><span style="color: #007700">))&nbsp;{<br /><a name="l104" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(array(</span><span style="color: #DD0000">"error"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"Error&nbsp;associating&nbsp;material&nbsp;with&nbsp;ticket—</span><span style="color: #0000BB">$mu_id</span><span style="color: #DD0000">"</span><span style="color: #007700">));<br /><a name="l105" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit();<br /><a name="l106" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l107" /><br /><a name="l108" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;no&nbsp;errors:&nbsp;create&nbsp;object<br /><a name="l109" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$mat_used&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Mats_Used</span><span style="color: #007700">(</span><span style="color: #0000BB">$mu_id</span><span style="color: #007700">);<br /><a name="l110" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ticket&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Transactions</span><span style="color: #007700">(</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">);<br /><a name="l111" /><br /><a name="l112" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;return&nbsp;instance_HTML<br /><a name="l113" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$HTML&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">edit_page_new_mat_used_HTML</span><span style="color: #007700">(</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">);<br /><a name="l114" />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(array(&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"mu_id"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$mu_id</span><span style="color: #007700">,<br /><a name="l115" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"material_HTML"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$HTML</span><span style="color: #007700">,&nbsp;<br /><a name="l116" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"material_name"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">material</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">m_name</span><span style="color: #007700">));<br /><a name="l117" />}<br /><a name="l118" /><br /><a name="l119" /><br /><a name="l120" /></span><span style="color: #FF8000">//&nbsp;if&nbsp;passed&nbsp;values&nbsp;do&nbsp;not&nbsp;match&nbsp;formatting,&nbsp;exit&nbsp;from&nbsp;system<br /><a name="l121" /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">check_posted_values</span><span style="color: #007700">(</span><span style="color: #0000BB">$m_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">)&nbsp;{<br /><a name="l122" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;check&nbsp;inputs<br /><a name="l123" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(!</span><span style="color: #0000BB">Materials</span><span style="color: #007700">::</span><span style="color: #0000BB">regexID</span><span style="color: #007700">(</span><span style="color: #0000BB">$m_id</span><span style="color: #007700">))&nbsp;{<br /><a name="l124" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(array(</span><span style="color: #DD0000">"error"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"Material&nbsp;#</span><span style="color: #0000BB">$m_id</span><span style="color: #DD0000">&nbsp;is&nbsp;invalid"</span><span style="color: #007700">));<br /><a name="l125" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit();<br /><a name="l126" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l127" />&nbsp;&nbsp;&nbsp;&nbsp;elseif(!</span><span style="color: #0000BB">Transactions</span><span style="color: #007700">::</span><span style="color: #0000BB">regexTrans</span><span style="color: #007700">(</span><span style="color: #0000BB">$trans_id</span><span style="color: #007700">))&nbsp;{<br /><a name="l128" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(array(</span><span style="color: #DD0000">"error"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"Ticket&nbsp;#</span><span style="color: #0000BB">$trans_id</span><span style="color: #DD0000">&nbsp;is&nbsp;invalid"</span><span style="color: #007700">));<br /><a name="l129" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit();<br /><a name="l130" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l131" />}<br /><a name="l132" /><br /><a name="l133" /><br /><a name="l134" /></span><span style="color: #FF8000">//&nbsp;——————————————————&nbsp;HTML&nbsp;———————————————————<br /><a name="l135" />//&nbsp;————————————————————————————————————————<br /><a name="l136" /><br /><a name="l137" /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">HTML_for_newly_added_mat_used</span><span style="color: #007700">(</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$grouped_and_ungrouped</span><span style="color: #007700">)&nbsp;{<br /><a name="l138" />&nbsp;&nbsp;&nbsp;&nbsp;foreach(</span><span style="color: #0000BB">$grouped_and_ungrouped</span><span style="color: #007700">[</span><span style="color: #DD0000">"grouped"</span><span style="color: #007700">]&nbsp;as&nbsp;</span><span style="color: #0000BB">$parent_name&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$grouped_mats_used</span><span style="color: #007700">)&nbsp;{<br /><a name="l139" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">in_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$grouped_mats_used</span><span style="color: #007700">))&nbsp;{<br /><a name="l140" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;material&nbsp;added&nbsp;has&nbsp;no&nbsp;group&nbsp;to&nbsp;add&nbsp;to<br /><a name="l141" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$grouped_mats_used</span><span style="color: #007700">)&nbsp;==&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">)<br /><a name="l142" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array(&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"HTML"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Mats_Used</span><span style="color: #007700">::</span><span style="color: #0000BB">grouped_materials_HTML</span><span style="color: #007700">(</span><span style="color: #0000BB">$grouped_mats_used</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$parent_name</span><span style="color: #007700">),<br /><a name="l143" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"grouplength"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">);<br /><a name="l144" /><br /><a name="l145" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;group&nbsp;already&nbsp;existed,&nbsp;add&nbsp;parent&nbsp;table&nbsp;to&nbsp;add&nbsp;to<br /><a name="l146" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;array(&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"HTML"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">instance_HTML</span><span style="color: #007700">(),<br /><a name="l147" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"grouplength"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$grouped_mats_used</span><span style="color: #007700">));<br /><a name="l148" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l149" /><br /><a name="l150" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l151" /><br /><a name="l152" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;prior&nbsp;single&nbsp;material&nbsp;of&nbsp;group,&nbsp;create&nbsp;new&nbsp;group:&nbsp;placed&nbsp;in&nbsp;table&nbsp;to&nbsp;allow&nbsp;for&nbsp;highlighting<br /><a name="l153" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$HTML&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"&lt;table&nbsp;class='table&nbsp;table-bordered'&gt;<br /><a name="l154" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br /><a name="l155" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;"</span><span style="color: #007700">.<br /><a name="l156" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">instance_HTML</span><span style="color: #007700">().<br /><a name="l157" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;/td&gt;<br /><a name="l158" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br /><a name="l159" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/table&gt;"</span><span style="color: #007700">;<br /><a name="l160" />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array(&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"HTML"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$HTML</span><span style="color: #007700">,&nbsp;<br /><a name="l161" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"grouplength"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /><a name="l162" />}<br /><a name="l163" /><br /><a name="l164" /><br /><a name="l165" />function&nbsp;</span><span style="color: #0000BB">mats_used_share_parents_and_not_same_instance</span><span style="color: #007700">(</span><span style="color: #0000BB">$mu1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$mu2</span><span style="color: #007700">)&nbsp;{<br /><a name="l166" />&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$mu1</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">mu_id&nbsp;</span><span style="color: #007700">!=&nbsp;</span><span style="color: #0000BB">$mu2</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">mu_id&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;</span><span style="color: #0000BB">$mu1</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">material</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">m_parent&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">$mu2</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">material</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">m_parent</span><span style="color: #007700">)<br /><a name="l167" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><a name="l168" />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><a name="l169" />}<br /><a name="l170" /><br /><a name="l171" /><br /><a name="l172" />function&nbsp;</span><span style="color: #0000BB">edit_page_new_mat_used_HTML</span><span style="color: #007700">(</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">)&nbsp;{<br /><a name="l173" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;———&nbsp;POPULATION&nbsp;STUFF&nbsp;———<br /><a name="l174" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$readonly&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$staff</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">operator&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">staff</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">operator&nbsp;</span><span style="color: #007700">?&nbsp;</span><span style="color: #DD0000">"readonly"&nbsp;</span><span style="color: #007700">:&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;prevent&nbsp;staff&nbsp;from&nbsp;listing&nbsp;someone&nbsp;else&nbsp;as&nbsp;changer<br /><a name="l175" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$mu_id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">mu_id</span><span style="color: #007700">;<br /><a name="l176" />&nbsp;&nbsp;&nbsp;&nbsp;<br /><a name="l177" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;options&nbsp;for&nbsp;material&nbsp;select<br /><a name="l178" />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;list&nbsp;all&nbsp;Materials&nbsp;that&nbsp;are&nbsp;available&nbsp;to&nbsp;that&nbsp;device<br /><a name="l179" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$material_options&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;<br /><a name="l180" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$device_materials&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Materials</span><span style="color: #007700">::</span><span style="color: #0000BB">getDeviceMats</span><span style="color: #007700">(</span><span style="color: #0000BB">$ticket</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">device</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">device_group</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">dg_id</span><span style="color: #007700">);<br /><a name="l181" />&nbsp;&nbsp;&nbsp;&nbsp;foreach(</span><span style="color: #0000BB">$device_materials&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$material</span><span style="color: #007700">)&nbsp;{<br /><a name="l182" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$selected&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$material</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">m_id&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">material</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">m_id&nbsp;</span><span style="color: #007700">?&nbsp;</span><span style="color: #DD0000">"selected"&nbsp;</span><span style="color: #007700">:&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;<br /><a name="l183" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$material_options&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"\n&lt;option&nbsp;</span><span style="color: #0000BB">$selected</span><span style="color: #DD0000">&nbsp;value='</span><span style="color: #0000BB">$material</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">m_id</span><span style="color: #DD0000">'&gt;</span><span style="color: #0000BB">$material</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">m_name</span><span style="color: #DD0000">&lt;/option&gt;"</span><span style="color: #007700">;<br /><a name="l184" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l185" /><br /><a name="l186" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;quantity&nbsp;<br /><a name="l187" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">material</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">is_measurable</span><span style="color: #007700">)&nbsp;{<br /><a name="l188" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$input&nbsp;</span><span style="color: #007700">=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;tr&gt;<br /><a name="l189" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<br /><a name="l190" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Quantity&nbsp;Used<br /><a name="l191" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br /><a name="l192" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<br /><a name="l193" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class='input-group'&gt;"</span><span style="color: #007700">;<br /><a name="l194" /><br /><a name="l195" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">material</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">unit&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #DD0000">"hour(s)"&nbsp;</span><span style="color: #007700">||&nbsp;</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">material</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">unit&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #DD0000">"hours"</span><span style="color: #007700">)&nbsp;{&nbsp;<br /><a name="l196" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$hour&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">floor</span><span style="color: #007700">(</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">quantity_used</span><span style="color: #007700">);<br /><a name="l197" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$minute&nbsp;</span><span style="color: #007700">=&nbsp;(</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">quantity_used&nbsp;</span><span style="color: #007700">-&nbsp;</span><span style="color: #0000BB">$hour</span><span style="color: #007700">)&nbsp;*&nbsp;</span><span style="color: #0000BB">60</span><span style="color: #007700">;<br /><a name="l198" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$input&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"&lt;span&nbsp;class='input-group-addon'&gt;"</span><span style="color: #007700">.</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">"&lt;i&nbsp;class='</span><span style="color: #0000BB">$sv</span><span style="color: #007700">[</span><span style="color: #0000BB">currency</span><span style="color: #007700">]</span><span style="color: #DD0000">'&gt;&lt;/i&gt;&nbsp;%.2f&nbsp;x&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">material</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">price</span><span style="color: #007700">).</span><span style="color: #DD0000">"&lt;/span&gt;<br /><a name="l199" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;hours&nbsp;is&nbsp;not&nbsp;set&nbsp;to&nbsp;a&nbsp;minimum&nbsp;because&nbsp;it&nbsp;is&nbsp;assumed&nbsp;staff&nbsp;knows&nbsp;what&nbsp;they&nbsp;are&nbsp;doing&nbsp;--&gt;<br /><a name="l200" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;class='form-control'&nbsp;type='number'&nbsp;name='</span><span style="color: #0000BB">$mu_id</span><span style="color: #DD0000">-hour'&nbsp;id='</span><span style="color: #0000BB">$mu_id</span><span style="color: #DD0000">-hour'&nbsp;autocomplete='off'&nbsp;tabindex='2'<br /><a name="l201" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value='</span><span style="color: #0000BB">$hour</span><span style="color: #DD0000">'&nbsp;min='0'&nbsp;max='9999'&nbsp;step='1'&nbsp;style='text-align:right;'&nbsp;onkeyup='change_edit_staff(this,&nbsp;\"</span><span style="color: #0000BB">$staff</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">operator</span><span style="color: #DD0000">\",&nbsp;4,&nbsp;1);'<br /><a name="l202" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onchange='change_edit_staff(this,&nbsp;\"</span><span style="color: #0000BB">$staff</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">operator</span><span style="color: #DD0000">\",&nbsp;4,&nbsp;1);'/&gt;<br /><a name="l203" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class='input-group-addon'&gt;Hours&lt;/span&gt;<br /><a name="l204" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;class='form-control'&nbsp;type='number'&nbsp;name='</span><span style="color: #0000BB">$mu_id</span><span style="color: #DD0000">-minute'&nbsp;id='</span><span style="color: #0000BB">$mu_id</span><span style="color: #DD0000">-minute'&nbsp;autocomplete='off'&nbsp;tabindex='2'<br /><a name="l205" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value='</span><span style="color: #0000BB">$minute</span><span style="color: #DD0000">'&nbsp;min='0'&nbsp;max='9999'&nbsp;style='text-align:right;'&nbsp;onkeyup='change_edit_staff(this,&nbsp;\"</span><span style="color: #0000BB">$staff</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">operator</span><span style="color: #DD0000">\",&nbsp;4,&nbsp;1);'<br /><a name="l206" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onchange='change_edit_staff(this,&nbsp;\"</span><span style="color: #0000BB">$staff</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">operator</span><span style="color: #DD0000">\",&nbsp;4,&nbsp;1);'/&gt;<br /><a name="l207" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class='input-group-addon'&gt;Minutes&lt;/span&gt;"</span><span style="color: #007700">;<br /><a name="l208" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l209" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{&nbsp;<br /><a name="l210" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$input&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"&lt;span&nbsp;class='input-group-addon'&gt;"</span><span style="color: #007700">.</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">"&lt;i&nbsp;class='</span><span style="color: #0000BB">$sv</span><span style="color: #007700">[</span><span style="color: #0000BB">currency</span><span style="color: #007700">]</span><span style="color: #DD0000">'&gt;&lt;/i&gt;&nbsp;%.2f&nbsp;x&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">material</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">price</span><span style="color: #007700">).</span><span style="color: #DD0000">"&lt;/span&gt;<br /><a name="l211" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;class='form-control'&nbsp;type='number'&nbsp;name='</span><span style="color: #0000BB">$mu_id</span><span style="color: #DD0000">-quantity'&nbsp;id='</span><span style="color: #0000BB">$mu_id</span><span style="color: #DD0000">-quantity'&nbsp;autocomplete='off'<br /><a name="l212" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value='</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">quantity_used</span><span style="color: #DD0000">'&nbsp;min='0'&nbsp;max='9999'&nbsp;onkeyup='change_edit_staff(this,&nbsp;\"</span><span style="color: #0000BB">$staff</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">operator</span><span style="color: #DD0000">\",&nbsp;4,&nbsp;1);'<br /><a name="l213" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;style='text-align:right;'&nbsp;onchange='change_edit_staff(this,&nbsp;\"</span><span style="color: #0000BB">$staff</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">operator</span><span style="color: #DD0000">\",&nbsp;4,&nbsp;1);'/&gt;<br /><a name="l214" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class='input-group-addon'&gt;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">material</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">unit</span><span style="color: #007700">.</span><span style="color: #DD0000">"&lt;/span&gt;"</span><span style="color: #007700">;<br /><a name="l215" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l216" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$input&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"&lt;/div&gt;<br /><a name="l217" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br /><a name="l218" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;"</span><span style="color: #007700">;<br /><a name="l219" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l220" /><br /><a name="l221" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$HTML&nbsp;</span><span style="color: #007700">=&nbsp;<br /><a name="l222" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;div&nbsp;class='panel-body'&gt;<br /><a name="l223" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;table&nbsp;id='mu-</span><span style="color: #0000BB">$mu_id</span><span style="color: #DD0000">'&nbsp;class='table&nbsp;table-bordered&nbsp;table-striped&nbsp;mats_used'&nbsp;style='table-layout:fixed'&gt;<br /><a name="l224" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br /><a name="l225" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;class='col-md-4'&gt;Material&lt;/td&gt;<br /><a name="l226" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;class='col-md-8'&gt;<br /><a name="l227" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;select&nbsp;name='&lt;?php&nbsp;echo&nbsp;</span><span style="color: #0000BB">$mu_id</span><span style="color: #DD0000">;&nbsp;?&gt;-material'&nbsp;id='&lt;?php&nbsp;echo&nbsp;</span><span style="color: #0000BB">$mu_id</span><span style="color: #DD0000">;&nbsp;?&gt;-material'&nbsp;class='form-control'&nbsp;<br /><a name="l228" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onchange='change_edit_staff(this,&nbsp;'</span><span style="color: #0000BB">$staff</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">operator</span><span style="color: #DD0000">',&nbsp;3,&nbsp;1);'&gt;<br /><a name="l229" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$material_options</span><span style="color: #DD0000"><br /><a name="l230" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/select&gt;<br /><a name="l231" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br /><a name="l232" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br /><a name="l233" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$input</span><span style="color: #DD0000"><br /><a name="l234" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br /><a name="l235" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Material&nbsp;Status&lt;/td&gt;<br /><a name="l236" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<br /><a name="l237" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;select&nbsp;name='</span><span style="color: #0000BB">$mu_id</span><span style="color: #DD0000">-select'&nbsp;id='</span><span style="color: #0000BB">$mu_id</span><span style="color: #DD0000">-select'&nbsp;class='form-control'&nbsp;<br /><a name="l238" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onchange='change_edit_staff(this,&nbsp;\"</span><span style="color: #0000BB">$staff</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">operator</span><span style="color: #DD0000">\",&nbsp;3,&nbsp;1);'&gt;<br /><a name="l239" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;option&nbsp;value='</span><span style="color: #0000BB">$status</span><span style="color: #007700">[</span><span style="color: #0000BB">used</span><span style="color: #007700">]</span><span style="color: #DD0000">'"</span><span style="color: #007700">.(</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">status</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">status_id&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">[</span><span style="color: #DD0000">"used"</span><span style="color: #007700">]&nbsp;?&nbsp;</span><span style="color: #DD0000">"selected"&nbsp;</span><span style="color: #007700">:&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">).</span><span style="color: #DD0000">"&gt;Used&lt;/option&gt;<br /><a name="l240" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;option&nbsp;value='</span><span style="color: #0000BB">$status</span><span style="color: #007700">[</span><span style="color: #0000BB">unused</span><span style="color: #007700">]</span><span style="color: #DD0000">'"</span><span style="color: #007700">.(</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">status</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">status_id&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">[</span><span style="color: #DD0000">"unused"</span><span style="color: #007700">]&nbsp;?&nbsp;</span><span style="color: #DD0000">"selected"&nbsp;</span><span style="color: #007700">:&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">).</span><span style="color: #DD0000">"&gt;Unused&lt;/option&gt;<br /><a name="l241" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;option&nbsp;value='</span><span style="color: #0000BB">$status</span><span style="color: #007700">[</span><span style="color: #0000BB">failed_mat</span><span style="color: #007700">]</span><span style="color: #DD0000">'"</span><span style="color: #007700">.(</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">status</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">status_id&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">[</span><span style="color: #DD0000">"failed_mat"</span><span style="color: #007700">]&nbsp;?&nbsp;</span><span style="color: #DD0000">"selected"&nbsp;</span><span style="color: #007700">:&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">).</span><span style="color: #DD0000">"&gt;Failed&nbsp;Material&lt;/option&gt;<br /><a name="l242" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/select&gt;<br /><a name="l243" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br /><a name="l244" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br /><a name="l245" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br /><a name="l246" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Staff&lt;/td&gt;<br /><a name="l247" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<br /><a name="l248" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type='number'&nbsp;name='</span><span style="color: #0000BB">$mu_id</span><span style="color: #DD0000">-staff'&nbsp;id='</span><span style="color: #0000BB">$mu_id</span><span style="color: #DD0000">-staff'&nbsp;placeholder='1000000000'&nbsp;<br /><a name="l249" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value='"</span><span style="color: #007700">.(</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">staff&nbsp;</span><span style="color: #007700">?&nbsp;</span><span style="color: #0000BB">$mat_used</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">staff</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">operator&nbsp;</span><span style="color: #007700">:&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">).</span><span style="color: #DD0000">"'&nbsp;onkeyup='restrict_size(this);'&nbsp;<br /><a name="l250" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onchange='restrict_size(this);'&nbsp;class='form-control'&nbsp;</span><span style="color: #0000BB">$readonly</span><span style="color: #DD0000">&gt;<br /><a name="l251" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br /><a name="l252" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br /><a name="l253" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/table&gt;<br /><a name="l254" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;&nbsp;&lt;!--&nbsp;/.panel-body&nbsp;--&gt;"</span><span style="color: #007700">;<br /><a name="l255" />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$HTML</span><span style="color: #007700">;<br /><a name="l256" />}<br /><a name="l257" /><br /><a name="l258" /></span><span style="color: #0000BB">?&gt;</span>
</span>